(self.webpackChunkprod=self.webpackChunkprod||[]).push([[195],{47715:function(e,t,r){e.exports=function(){"use strict";var e=Function.prototype.toString,t=Object.create,n=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,c=Object.getPrototypeOf,a=Object.prototype,u=a.hasOwnProperty,l=a.propertyIsEnumerable,f="function"==typeof s,d="function"==typeof WeakMap,h=function(r,n){if(!r.constructor)return t(null);var o=r.constructor,i=r.__proto__||c(r);if(o===n.Object)return i===n.Object.prototype?{}:t(i);if(~e.call(o).indexOf("[native code]"))try{return new o}catch(e){}return t(i)},v=function(e,t,r,n){var o=h(e,t);for(var i in n.set(e,o),e)u.call(e,i)&&(o[i]=r(e[i],n));if(f){var c=s(e),a=c.length;if(a)for(var d=0,v=void 0;d<a;d++)v=c[d],l.call(e,v)&&(o[v]=r(e[v],n))}return o},p=function(e,t,r,c){var a=h(e,t);c.set(e,a);var u=f?i(e).concat(s(e)):i(e),l=u.length;if(l)for(var d=0,v=void 0,p=void 0;d<l;d++)if("callee"!==(v=u[d])&&"caller"!==v)if(p=o(e,v)){p.get||p.set||(p.value=r(e[v],c));try{n(a,v,p)}catch(e){a[v]=p.value}}else a[v]=r(e[v],c);return a},y=Array.isArray,w="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:void(console&&console.error&&console.error('Unable to locate global object, returning "this".'));function m(e,r){var n=!(!r||!r.isStrict),o=r&&r.realm||w,i=n?p:v,s=function(e,t){if(!e||"object"!=typeof e)return e;if(t.has(e))return t.get(e);var r,c,a,u=e.constructor;if(u===o.Object)return i(e,o,s,t);if(y(e)){if(n)return p(e,o,s,t);var l=e.length;r=new u,t.set(e,r);for(var f=0;f<l;f++)r[f]=s(e[f],t);return r}if(e instanceof o.Date)return new u(e.getTime());if(e instanceof o.RegExp)return(r=new u(e.source,e.flags||(c=e,a="",c.global&&(a+="g"),c.ignoreCase&&(a+="i"),c.multiline&&(a+="m"),c.unicode&&(a+="u"),c.sticky&&(a+="y"),a))).lastIndex=e.lastIndex,r;if(o.Map&&e instanceof o.Map)return r=new u,t.set(e,r),e.forEach((function(e,n){r.set(n,s(e,t))})),r;if(o.Set&&e instanceof o.Set)return r=new u,t.set(e,r),e.forEach((function(e){r.add(s(e,t))})),r;if(o.Blob&&e instanceof o.Blob)return e.slice(0,e.size,e.type);if(o.Buffer&&o.Buffer.isBuffer(e))return r=o.Buffer.allocUnsafe?o.Buffer.allocUnsafe(e.length):new u(e.length),t.set(e,r),e.copy(r),r;if(o.ArrayBuffer){if(o.ArrayBuffer.isView(e))return r=new u(e.buffer.slice(0)),t.set(e,r),r;if(e instanceof o.ArrayBuffer)return r=e.slice(0),t.set(e,r),r}return"function"==typeof e.then||e instanceof Error||o.WeakMap&&e instanceof o.WeakMap||o.WeakSet&&e instanceof o.WeakSet?e:i(e,o,s,t)};return s(e,function(){if(d)return new WeakMap;var e=t({has:function(t){return!!~e._keys.indexOf(t)},set:function(t,r){e._keys.push(t),e._values.push(r)},get:function(t){return e._values[e._keys.indexOf(t)]}});return e._keys=[],e._values=[],e}())}return m.default=m,m.strict=function(e,t){return m(e,{isStrict:!0,realm:t?t.realm:void 0})},m}()},66866:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveQuery=void 0;const n=r(41350),o=r(47715);class i extends n.TxProcessor{constructor(e){super(),this.client=e,this.queries=new Map,this.qid=n.generateId()}isDerived(e,t){return this.client.isDerived(e,t)}match(e,t){if(!this.isDerived(t._class,e._class))return!1;for(const r in e.query){const o=e.query[r];if(0===n.findProperty([t],r,o).length)return!1}return!0}async findAll(e,t,r){return await this.client.findAll(e,t,r)}query(e,t,r,i){const s=this.client.findAll(e,t,i),c={_id:n.generateId(),_class:e,query:t,result:s,total:0,options:i,callback:r};return this.queries.set(c._id,c),s.then((e=>{c.result=o.default(e),c.total=e.total,c.callback(e)})).catch((e=>{console.log("failed to update Live Query: ",e)})),()=>{this.queries.delete(c._id)}}matchQuery(e,t){if(!this.isDerived(e._class,t.objectClass))return!1;for(const r in e.query){const o=e.query[r];if(1===n.findProperty([t.operations],r,o).length)return!0}return!1}async txUpdateDoc(e){for(const t of this.queries.values()){t.result instanceof Promise&&(t.result=o.default(await t.result));const r=t.result.findIndex((t=>t._id===e.objectId));if(-1!==r){const n=t.result[r],o=this.doUpdateDoc(n,e);this.match(t,o)?t.result[r]=o:(t.result.splice(r,1),t.total--),this.sort(t,e),await this.callback(o,t)}else this.matchQuery(t,e)&&await this.refresh(t)}}async txCreateDoc(e){var t,r,i,s;const c=n.TxProcessor.createDoc2Doc(e);for(const e of this.queries.values())this.match(e,c)&&(e.result instanceof Promise&&(e.result=o.default(await e.result)),e.result.push(c),e.total++,void 0!==(null===(t=e.options)||void 0===t?void 0:t.sort)&&n.resultSort(e.result,null===(r=e.options)||void 0===r?void 0:r.sort),void 0!==(null===(i=e.options)||void 0===i?void 0:i.limit)&&e.result.length>e.options.limit?(null===(s=e.result.pop())||void 0===s?void 0:s._id)!==c._id&&e.callback(Object.assign(e.result,{total:e.total})):e.callback(Object.assign(e.result,{total:e.total})))}async txRemoveDoc(e){var t;for(const r of this.queries.values()){r.result instanceof Promise&&(r.result=o.default(await r.result));const n=r.result.findIndex((t=>t._id===e.objectId));if(void 0!==(null===(t=r.options)||void 0===t?void 0:t.limit)&&r.options.limit===r.result.length&&this.isDerived(r._class,e.objectClass))return await this.refresh(r);n>-1&&(r.result.splice(n,1),r.callback(Object.assign(r.result,{total:--r.total})))}}async tx(e){await this.client.tx(e)}async notifyTx(e){await super.tx(e)}doUpdateDoc(e,t){const r=o.default(e),i=t.operations;for(const e in i)e.startsWith("$")?n.getOperator(e)(r,i[e]):r[e]=i[e];return r.modifiedBy=t.modifiedBy,r.modifiedOn=t.modifiedOn,r}async refresh(e){const t=await this.client.findAll(e._class,e.query,e.options);e.result=o.default(t),e.total=t.total,e.callback(t)}sort(e,t){var r;const o=null===(r=e.options)||void 0===r?void 0:r.sort;if(void 0===o)return;let i=void 0!==o.modifiedBy||void 0!==o.modifiedOn;i||(i=this.checkNeedSort(o,t)),i&&n.resultSort(e.result,o)}checkNeedSort(e,t){const r=t.operations;for(const t in r)if(t.startsWith("$")){for(const n in r[t])if(n in e)return!0}else if(t in e)return!0;return!1}async callback(e,t){var r,n;if(t.result=t.result,void 0!==(null===(r=t.options)||void 0===r?void 0:r.limit)&&t.total>t.options.limit&&(null===(n=t.result.pop())||void 0===n?void 0:n._id)===e._id)return await this.refresh(t);t.callback(Object.assign(t.result,{total:t.total}))}}t.LiveQuery=i},69349:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestProcessor=t.Code=t.fromStatus=t.readRequest=t.readResponse=t.serialize=t.Request=void 0;const n=r(98097);t.Request=class{constructor(e,...t){this.method=e,this.params=t}},t.serialize=function(e){return JSON.stringify(e)},t.readResponse=function(e){return JSON.parse(e)},t.readRequest=function(e){const r=JSON.parse(e);if("string"!=typeof r.method)throw new n.PlatformError(new n.Status(n.Severity.ERROR,t.Code.BadRequest,{}));return r},t.fromStatus=function(e,t){return{id:t,error:e}},t.Code=n.component("rpc",{Unauthorized:"",Forbidden:"",BadRequest:"",UnknownMethod:""});class o{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}t.RequestProcessor=class{constructor(){this.reqIndex=0,this.requests=new Map}process(e){if(void 0!==e.id){const t=this.requests.get(e.id);if(void 0!==t)return void 0!==e.error?(console.error(e.error),void t.reject(new n.PlatformError(e.error))):void t.resolve(e.result)}this.notify(e)}reject(e){for(const t of this.requests.entries())t[1].reject(new n.PlatformError(e));this.requests.clear()}async request(e,...t){const r=++this.reqIndex,n=new o;return this.requests.set(r,n),this.send({id:r,method:e,params:t}),await n.promise}}},49538:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.connect=void 0;const o=r(69349),i=r(98097);class s extends o.RequestProcessor{constructor(e,t){super(),this.socket=e,this.handler=t,e.onerror=()=>this.reject(i.unknownStatus("Unknown error")),e.onclose=e=>this.reject(i.unknownStatus(`Connection close: ${e.reason}`)),e.onmessage=e=>this.onmessage(e)}onmessage(e){this.process(o.readResponse(e.data))}send(e){this.socket.send(o.serialize(e))}notify(e){void 0!==e.result&&this.handler(e.result)}findAll(e,t){return n(this,void 0,void 0,(function*(){return yield this.request("findAll",e,t)}))}accountId(){return n(this,void 0,void 0,(function*(){return yield this.request("accountId")}))}tx(e){return n(this,void 0,void 0,(function*(){yield this.request("tx",e),this.handler(e)}))}}t.connect=function(e,t){return n(this,void 0,void 0,(function*(){const r=new WebSocket(`ws://${e}`);return yield new Promise(((t,n)=>{r.onopen=t,r.onerror=n.bind(new Error(`Failed to connect to ${e}`)),setTimeout((()=>n.bind(new Error(`Failed to connect to ${e}`))),5e3)})),{storage:new s(r,t),close:r.close.bind(r)}}))}},64939:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,i){function s(e){try{a(n.next(e))}catch(e){i(e)}}function c(e){try{a(n.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,c)}a((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=r(41350),i=r(9479),s=r(14452),c=r(66866),a=r(49538);let u,l,f;function d(e){var t;return n(this,void 0,void 0,(function*(){const r=null!==(t=i.getMetadata(s.default.metadata.ClientUrl))&&void 0!==t?t:"localhost:18080",{storage:n,close:o}=yield a.connect(r,e);return l=o,n}))}function h(){return n(this,void 0,void 0,(function*(){if(void 0===u){const e=yield o.createClient(d,(e=>{null==f||f.notifyTx(e).catch((e=>console.error(e)))})),t=yield e.accountId();f=new c.LiveQuery(e),u=o.withOperations(t,f)}return u}))}function v(){return n(this,void 0,void 0,(function*(){null==l||l(),u=void 0}))}t.default=()=>n(void 0,void 0,void 0,(function*(){return{getClient:h,disconnect:v}}))}}]);
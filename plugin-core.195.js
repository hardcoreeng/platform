(self.webpackChunkprod=self.webpackChunkprod||[]).push([[195],{47715:function(t,e,r){t.exports=function(){"use strict";var t=Function.prototype.toString,e=Object.create,n=Object.defineProperty,o=Object.getOwnPropertyDescriptor,i=Object.getOwnPropertyNames,s=Object.getOwnPropertySymbols,a=Object.getPrototypeOf,c=Object.prototype,u=c.hasOwnProperty,l=c.propertyIsEnumerable,f="function"==typeof s,d="function"==typeof WeakMap,h=function(r,n){if(!r.constructor)return e(null);var o=r.constructor,i=r.__proto__||a(r);if(o===n.Object)return i===n.Object.prototype?{}:e(i);if(~t.call(o).indexOf("[native code]"))try{return new o}catch(t){}return e(i)},v=function(t,e,r,n){var o=h(t,e);for(var i in n.set(t,o),t)u.call(t,i)&&(o[i]=r(t[i],n));if(f){var a=s(t),c=a.length;if(c)for(var d=0,v=void 0;d<c;d++)v=a[d],l.call(t,v)&&(o[v]=r(t[v],n))}return o},p=function(t,e,r,a){var c=h(t,e);a.set(t,c);var u=f?i(t).concat(s(t)):i(t),l=u.length;if(l)for(var d=0,v=void 0,p=void 0;d<l;d++)if("callee"!==(v=u[d])&&"caller"!==v)if(p=o(t,v)){p.get||p.set||(p.value=r(t[v],a));try{n(c,v,p)}catch(t){c[v]=p.value}}else c[v]=r(t[v],a);return c},y=Array.isArray,w="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==r.g?r.g:void(console&&console.error&&console.error('Unable to locate global object, returning "this".'));function m(t,r){var n=!(!r||!r.isStrict),o=r&&r.realm||w,i=n?p:v,s=function(t,e){if(!t||"object"!=typeof t)return t;if(e.has(t))return e.get(t);var r,a,c,u=t.constructor;if(u===o.Object)return i(t,o,s,e);if(y(t)){if(n)return p(t,o,s,e);var l=t.length;r=new u,e.set(t,r);for(var f=0;f<l;f++)r[f]=s(t[f],e);return r}if(t instanceof o.Date)return new u(t.getTime());if(t instanceof o.RegExp)return(r=new u(t.source,t.flags||(a=t,c="",a.global&&(c+="g"),a.ignoreCase&&(c+="i"),a.multiline&&(c+="m"),a.unicode&&(c+="u"),a.sticky&&(c+="y"),c))).lastIndex=t.lastIndex,r;if(o.Map&&t instanceof o.Map)return r=new u,e.set(t,r),t.forEach((function(t,n){r.set(n,s(t,e))})),r;if(o.Set&&t instanceof o.Set)return r=new u,e.set(t,r),t.forEach((function(t){r.add(s(t,e))})),r;if(o.Blob&&t instanceof o.Blob)return t.slice(0,t.size,t.type);if(o.Buffer&&o.Buffer.isBuffer(t))return r=o.Buffer.allocUnsafe?o.Buffer.allocUnsafe(t.length):new u(t.length),e.set(t,r),t.copy(r),r;if(o.ArrayBuffer){if(o.ArrayBuffer.isView(t))return r=new u(t.buffer.slice(0)),e.set(t,r),r;if(t instanceof o.ArrayBuffer)return r=t.slice(0),e.set(t,r),r}return"function"==typeof t.then||t instanceof Error||o.WeakMap&&t instanceof o.WeakMap||o.WeakSet&&t instanceof o.WeakSet?t:i(t,o,s,e)};return s(t,function(){if(d)return new WeakMap;var t=e({has:function(e){return!!~t._keys.indexOf(e)},set:function(e,r){t._keys.push(e),t._values.push(r)},get:function(e){return t._values[t._keys.indexOf(e)]}});return t._keys=[],t._values=[],t}())}return m.default=m,m.strict=function(t,e){return m(t,{isStrict:!0,realm:e?e.realm:void 0})},m}()},66866:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LiveQuery=void 0;const n=r(41350),o=r(47715);class i extends n.TxProcessor{constructor(t){super(),this.client=t,this.queries=new Map}isDerived(t,e){return this.client.isDerived(t,e)}match(t,e){if(!this.isDerived(e._class,t._class))return!1;for(const r in t.query){const o=t.query[r];if(0===n.findProperty([e],r,o).length)return!1}return!0}async findAll(t,e,r){return await this.client.findAll(t,e,r)}query(t,e,r,i){const s=this.client.findAll(t,e,i),a={_id:n.generateId(),_class:t,query:e,result:s,total:0,options:i,callback:r};return this.queries.set(a._id,a),s.then((t=>{a.result=o.default(t),a.total=t.total,a.callback(o.default(t))})).catch((t=>{console.log("failed to update Live Query: ",t)})),()=>{this.queries.delete(a._id)}}matchQuery(t,e){if(!this.isDerived(t._class,e.objectClass))return!1;for(const r in t.query){const o=t.query[r];if(1===n.findProperty([e.operations],r,o).length)return!0}return!1}async txUpdateDoc(t){for(const e of this.queries.values()){if(e.result instanceof Promise){const t=await e.result;e.result=o.default(t),e.total=t.total}const r=e.result.findIndex((e=>e._id===t.objectId));if(-1!==r){const n=e.result[r],o=this.doUpdateDoc(n,t);this.match(e,o)?e.result[r]=o:(e.result.splice(r,1),e.total--),this.sort(e,t),await this.callback(o,e)}else this.matchQuery(e,t)&&await this.refresh(e)}}async txCreateDoc(t){var e,r,i,s;const a=n.TxProcessor.createDoc2Doc(t);for(const t of this.queries.values())if(this.match(t,a)){if(t.result instanceof Promise){const e=await t.result;t.result=o.default(e),t.total=e.total}t.result.push(a),t.total++,void 0!==(null===(e=t.options)||void 0===e?void 0:e.sort)&&n.resultSort(t.result,null===(r=t.options)||void 0===r?void 0:r.sort),void 0!==(null===(i=t.options)||void 0===i?void 0:i.limit)&&t.result.length>t.options.limit?(null===(s=t.result.pop())||void 0===s?void 0:s._id)!==a._id&&t.callback(Object.assign(o.default(t.result),{total:t.total})):t.callback(Object.assign(o.default(t.result),{total:t.total}))}}async txRemoveDoc(t){var e;for(const r of this.queries.values()){if(r.result instanceof Promise){const t=await r.result;r.result=o.default(t),r.total=t.total}const n=r.result.findIndex((e=>e._id===t.objectId));if(void 0!==(null===(e=r.options)||void 0===e?void 0:e.limit)&&r.options.limit===r.result.length&&this.isDerived(r._class,t.objectClass))return await this.refresh(r);n>-1&&(r.result.splice(n,1),r.callback(Object.assign(o.default(r.result),{total:r.total})))}}async tx(t){await this.client.tx(t)}async notifyTx(t){await super.tx(t)}doUpdateDoc(t,e){const r=o.default(t),i=e.operations;for(const t in i)t.startsWith("$")?n.getOperator(t)(r,i[t]):r[t]=o.default(i[t]);return r.modifiedBy=e.modifiedBy,r.modifiedOn=e.modifiedOn,r}async refresh(t){const e=await this.client.findAll(t._class,t.query,t.options);t.result=o.default(e),t.total=e.total,t.callback(o.default(e))}sort(t,e){var r;const o=null===(r=t.options)||void 0===r?void 0:r.sort;if(void 0===o)return;let i=void 0!==o.modifiedBy||void 0!==o.modifiedOn;i||(i=this.checkNeedSort(o,e)),i&&n.resultSort(t.result,o)}checkNeedSort(t,e){const r=e.operations;for(const e in r)if(e.startsWith("$")){for(const n in r[e])if(n in t)return!0}else if(e in t)return!0;return!1}async callback(t,e){var r,n;if(e.result=e.result,void 0!==(null===(r=e.options)||void 0===r?void 0:r.limit)&&e.total>e.options.limit&&(null===(n=e.result.pop())||void 0===n?void 0:n._id)===t._id)return await this.refresh(e);e.callback(Object.assign(o.default(e.result),{total:e.total}))}}e.LiveQuery=i},69349:(t,e,r)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RequestProcessor=e.Code=e.fromStatus=e.readRequest=e.readResponse=e.serialize=e.Request=void 0;const n=r(98097);function o(t,e){return e instanceof Map?{dataType:"Map",value:Array.from(e.entries())}:e}function i(t,e){return"object"==typeof e&&null!==e&&"Map"===e.dataType?new Map(e.value):e}e.Request=class{constructor(t,...e){this.method=t,this.params=e}},e.serialize=function(t){return JSON.stringify(t,o)},e.readResponse=function(t){return JSON.parse(t,i)},e.readRequest=function(t){const r=JSON.parse(t);if("string"!=typeof r.method)throw new n.PlatformError(new n.Status(n.Severity.ERROR,e.Code.BadRequest,{}));return r},e.fromStatus=function(t,e){return{id:e,error:t}},e.Code=n.component("rpc",{Unauthorized:"",Forbidden:"",BadRequest:"",UnknownMethod:""});class s{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}e.RequestProcessor=class{constructor(){this.reqIndex=0,this.requests=new Map}process(t){if(void 0!==t.id){const e=this.requests.get(t.id);if(void 0!==e)return void 0!==t.error?(console.error(t.error),void e.reject(new n.PlatformError(t.error))):void e.resolve(t.result)}this.notify(t)}reject(t){for(const e of this.requests.entries())e[1].reject(new n.PlatformError(t));this.requests.clear()}async request(t,...e){const r=++this.reqIndex,n=new s;return this.requests.set(r,n),this.send({id:r,method:t,params:e}),await n.promise}}},49538:function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.connect=void 0;const o=r(69349),i=r(98097);class s extends o.RequestProcessor{constructor(t,e){super(),this.socket=t,this.handler=e,t.onerror=()=>this.reject(i.unknownStatus("Unknown error")),t.onclose=t=>this.reject(i.unknownStatus(`Connection close: ${t.reason}`)),t.onmessage=t=>this.onmessage(t)}onmessage(t){this.process(o.readResponse(t.data))}send(t){this.socket.send(o.serialize(t))}notify(t){void 0!==t.result&&this.handler(t.result)}findAll(t,e){return n(this,void 0,void 0,(function*(){return yield this.request("findAll",t,e)}))}accountId(){return n(this,void 0,void 0,(function*(){return yield this.request("accountId")}))}tx(t){return n(this,void 0,void 0,(function*(){yield this.request("tx",t),this.handler(t)}))}}e.connect=function(t,e){return n(this,void 0,void 0,(function*(){const r=new WebSocket(`ws://${t}`);return yield new Promise(((e,n)=>{r.onopen=e,r.onerror=n.bind(new Error(`Failed to connect to ${t}`)),setTimeout((()=>n.bind(new Error(`Failed to connect to ${t}`))),5e3)})),{storage:new s(r,e),close:r.close.bind(r)}}))}},64939:function(t,e,r){"use strict";var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function s(t){try{c(n.next(t))}catch(t){i(t)}}function a(t){try{c(n.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=r(41350),i=r(9479),s=r(14452),a=r(66866),c=r(49538);let u,l,f;function d(t){var e;return n(this,void 0,void 0,(function*(){const r=null!==(e=i.getMetadata(s.default.metadata.ClientUrl))&&void 0!==e?e:"localhost:18080",{storage:n,close:o}=yield c.connect(r,t);return l=o,n}))}function h(){return n(this,void 0,void 0,(function*(){if(void 0===u){const t=yield o.createClient(d,(t=>{null==f||f.notifyTx(t).catch((t=>console.error(t)))})),e=yield t.accountId();f=new a.LiveQuery(t),u=o.withOperations(e,f)}return u}))}function v(){return n(this,void 0,void 0,(function*(){null==l||l(),u=void 0}))}e.default=()=>n(void 0,void 0,void 0,(function*(){return{getClient:h,disconnect:v}}))}}]);
(self.webpackChunkprod=self.webpackChunkprod||[]).push([[644],{91348:(e,t,n)=>{var i=/^\s+|\s+$/g,r=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,l="object"==typeof self&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),d=Object.prototype.toString,h=Math.max,p=Math.min,f=function(){return u.Date.now()};function m(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function g(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return!!e&&"object"==typeof e}(e)&&"[object Symbol]"==d.call(e)}(e))return NaN;if(m(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=m(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(i,"");var n=s.test(e);return n||o.test(e)?a(e.slice(2),n?2:8):r.test(e)?NaN:+e}e.exports=function(e,t,n){var i,r,s,o,a,c,l=0,u=!1,d=!1,v=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=i,s=r;return i=r=void 0,l=t,o=e.apply(s,n)}function $(e){return l=e,a=setTimeout(w,t),u?y(e):o}function b(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=s}function w(){var e=f();if(b(e))return S(e);a=setTimeout(w,function(e){var n=t-(e-c);return d?p(n,s-(e-l)):n}(e))}function S(e){return a=void 0,v&&i?y(e):(i=r=void 0,o)}function _(){var e=f(),n=b(e);if(i=arguments,r=this,c=e,n){if(void 0===a)return $(c);if(d)return a=setTimeout(w,t),y(c)}return void 0===a&&(a=setTimeout(w,t)),o}return t=g(t)||0,m(n)&&(u=!!n.leading,s=(d="maxWait"in n)?h(g(n.maxWait)||0,t):s,v="trailing"in n?!!n.trailing:v),_.cancel=function(){void 0!==a&&clearTimeout(a),l=0,i=c=r=a=void 0},_.flush=function(){return void 0===a?o:S(f())},_}},69349:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RequestProcessor=t.Code=t.fromStatus=t.readRequest=t.readResponse=t.serialize=t.Request=void 0;const i=n(98097);function r(e,t){return t instanceof Map?{dataType:"Map",value:Array.from(t.entries())}:t}function s(e,t){return"object"==typeof t&&null!==t&&"Map"===t.dataType?new Map(t.value):t}t.Request=class{constructor(e,...t){this.method=e,this.params=t}},t.serialize=function(e){return JSON.stringify(e,r)},t.readResponse=function(e){return JSON.parse(e,s)},t.readRequest=function(e){const n=JSON.parse(e);if("string"!=typeof n.method)throw new i.PlatformError(new i.Status(i.Severity.ERROR,t.Code.BadRequest,{}));return n},t.fromStatus=function(e,t){return{id:t,error:e}},t.Code=i.component("rpc",{Unauthorized:"",Forbidden:"",BadRequest:"",UnknownMethod:""});class o{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}t.RequestProcessor=class{constructor(){this.reqIndex=0,this.requests=new Map}process(e){if(void 0!==e.id){const t=this.requests.get(e.id);if(void 0!==t)return void 0!==e.error?(console.error(e.error),void t.reject(new i.PlatformError(e.error))):void t.resolve(e.result)}this.notify(e)}reject(e){for(const t of this.requests.entries())t[1].reject(new i.PlatformError(e));this.requests.clear()}async request(e,...t){const n=++this.reqIndex,i=new o;return this.requests.set(n,i),this.send({id:n,method:e,params:t}),await i.promise}}},83315:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StopScreenSharingReq=t.InitScreenSharingReq=t.TransmitReq=t.PeerUpdateReq=t.LeaveReq=t.JoinReq=t.isScreenID=t.getScreenOwner=t.makeScreenID=void 0;const i=n(69349),r="-screen";t.makeScreenID=e=>`${e}-screen`,t.getScreenOwner=e=>e.slice(0,-r.length),t.isScreenID=e=>e.endsWith(r);class s extends i.Request{}t.JoinReq=s;class o extends i.Request{}t.LeaveReq=o;class a extends i.Request{}t.PeerUpdateReq=a;class c extends i.Request{}t.TransmitReq=c;class l extends i.Request{}t.InitScreenSharingReq=l;class u extends i.Request{}t.StopScreenSharingReq=u},47539:function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(69349);class s extends r.RequestProcessor{constructor(e){super(),this.subs=new Map,this.ws=this.initWS(e)}send(e){this.ws.then((t=>{t.send(r.serialize(e))}))}notify(e){var t,n;const i=null===(t=e.result)||void 0===t?void 0:t.notification;void 0!==i&&(null!==(n=this.subs.get(i))&&void 0!==n?n:[]).forEach((t=>t(e)))}initWS(e){return i(this,void 0,void 0,(function*(){return yield new Promise((t=>{const n=new WebSocket(e);n.addEventListener("open",(()=>t(n))),n.addEventListener("close",(()=>{this.ws=new Promise((()=>{})),setTimeout((()=>{this.ws=this.initWS(e)}),1e3)})),n.addEventListener("error",(e=>{console.error("Communication error occured:",e)})),n.addEventListener("message",(e=>{this.process(r.readResponse(e.data))}))}))}))}sendRequest(e){return i(this,void 0,void 0,(function*(){return yield this.request(e.method,...e.params)}))}sendNotification(e){this.send(e)}subscribe(e,t){var n;const i=null!==(n=this.subs.get(e))&&void 0!==n?n:[];return i.push(t),this.subs.set(e,i),()=>{var n;return this.subs.set(e,(null!==(n=this.subs.get(e))&&void 0!==n?n:[]).filter((e=>e!==t)))}}}t.Client=s},62832:function(e,t,n){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||i(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.TaskQueue=void 0,r(n(83315),t);var s=n(75746);Object.defineProperty(t,"TaskQueue",{enumerable:!0,get:function(){return s.TaskQueue}});var o=n(47539);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return o.Client}})},75746:function(e,t){"use strict";var n=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((i=i.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.TaskQueue=void 0,t.TaskQueue=class{constructor(){this.queue=[],this.inProgress=!1}add(e){return n(this,void 0,void 0,(function*(){const t=new Promise(((t,i)=>{this.queue.push((()=>n(this,void 0,void 0,(function*(){yield e().then(t).catch(i)}))))}));return yield this.dequeue(),yield t}))}dequeue(){return n(this,void 0,void 0,(function*(){if(this.inProgress)return;const e=this.queue.shift();void 0!==e&&(this.inProgress=!0,yield e(),this.inProgress=!1,yield this.dequeue())}))}}},61506:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ie,roomMgr:()=>re});var i=n(9479),r=n(62832),s=n(3130),o=n(26148),a=n(9862),c=n(56195),l=n(91348),u=n.n(l),d=n(31379),h=n(98097),p=Object.defineProperty,f=Object.defineProperties,m=Object.getOwnPropertyDescriptors,g=Object.getOwnPropertySymbols,v=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable,$=Math.pow,b=(e,t,n)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))v.call(t,n)&&b(e,n,t[n]);if(g)for(var n of g(t))y.call(t,n)&&b(e,n,t[n]);return e},S=(e,t)=>f(e,m(t)),_=(e,t)=>p(e,"name",{value:t,configurable:!0}),I=(e,t,n)=>new Promise(((i,r)=>{var s=e=>{try{a(n.next(e))}catch(e){r(e)}},o=e=>{try{a(n.throw(e))}catch(e){r(e)}},a=e=>e.done?i(e.value):Promise.resolve(e.value).then(s,o);a((n=n.apply(e,t)).next())}));function M(e){let t,n,i,r,a,c,l;n=new o.k3({props:{label:"Name",value:"Channel Name"},$$inline:!0}),r=new o.k3({props:{label:"Description",value:"This is a little description"},$$inline:!0}),c=new o.fL({props:{label:"Make channel private",description:"Lorem ipsum dolor sit amet quantum nunca sic"},$$inline:!0});const u={c:_((function(){t=(0,s.bGB)("div"),(0,s.YCL)(n.$$.fragment),i=(0,s.DhX)(),(0,s.YCL)(r.$$.fragment),a=(0,s.DhX)(),(0,s.YCL)(c.$$.fragment),(0,s.LGW)(t,"class","content svelte-sc4c5l"),(0,s.vjr)(t,"src/components/CreateChannel.svelte",18,2,744)}),"create"),m:_((function(e,o){(0,s.DsI)(e,t,o),(0,s.yef)(n,t,null),(0,s.gOb)(t,i),(0,s.yef)(r,t,null),(0,s.gOb)(t,a),(0,s.yef)(c,t,null),l=!0}),"mount"),p:s.ZTd,i:_((function(e){l||((0,s.Ui)(n.$$.fragment,e),(0,s.Ui)(r.$$.fragment,e),(0,s.Ui)(c.$$.fragment,e),l=!0)}),"intro"),o:_((function(e){(0,s.etI)(n.$$.fragment,e),(0,s.etI)(r.$$.fragment,e),(0,s.etI)(c.$$.fragment,e),l=!1}),"outro"),d:_((function(e){e&&(0,s.GlD)(t),(0,s.vpE)(n),(0,s.vpE)(r),(0,s.vpE)(c)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:u,id:M.name,type:"slot",source:'(18:0) <Dialog label=\\"Create Channel\\">',ctx:e}),u}function k(e){let t,n;t=new o.Vq({props:{label:"Create Channel",$$slots:{default:[M]},$$scope:{ctx:e}},$$inline:!0});const i={c:_((function(){(0,s.YCL)(t.$$.fragment)}),"create"),l:_((function(e){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")}),"claim"),m:_((function(e,i){(0,s.yef)(t,e,i),n=!0}),"mount"),p:_((function(e,[n]){const i={};1&n&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)}),"update"),i:_((function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)}),"intro"),o:_((function(e){(0,s.etI)(t.$$.fragment,e),n=!1}),"outro"),d:_((function(e){(0,s.vpE)(t,e)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:i,id:k.name,type:"component",source:"",ctx:e}),i}function P(e,t,n){let{$$slots:i={},$$scope:r}=t;(0,s.KXV)("CreateChannel",i,[]);const a=[];return Object.keys(t).forEach((e=>{~a.indexOf(e)||"$$"===e.slice(0,2)||"slot"===e||console.warn(`<CreateChannel> was created with unknown prop '${e}'`)})),e.$capture_state=()=>({EditBox:o.k3,Dialog:o.Vq,ToggleWithLabel:o.fL}),[]}_(M,"create_default_slot"),_(k,"create_fragment"),_(P,"instance");var R=class extends s.Mjb{constructor(e){super(e),(0,s.S1n)(this,e,P,k,s.N8,{}),(0,s.YyZ)("SvelteRegisterComponent",{component:this,tagName:"CreateChannel",options:e,id:k.name})}};_(R,"CreateChannel");var D=R;function j(e){let t,n;const i={c:_((function(){t=(0,s.bGB)("video"),(0,s.LGW)(t,"class","video svelte-tjpcit"),t.autoplay=!0,t.muted=e[0],t.controls=n=!1,(0,s.VHj)(t,"mVideoSpeaking",e[1]>0),(0,s.VHj)(t,"mVideoFull",e[2]),(0,s.vjr)(t,"src/components/PeerStream.svelte",24,0,788)}),"create"),l:_((function(e){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")}),"claim"),m:_((function(n,i){(0,s.DsI)(n,t,i),e[5](t)}),"mount"),p:_((function(e,[n]){1&n&&(0,s.i4P)(t,"muted",e[0]),2&n&&(0,s.VHj)(t,"mVideoSpeaking",e[1]>0),4&n&&(0,s.VHj)(t,"mVideoFull",e[2])}),"update"),i:s.ZTd,o:s.ZTd,d:_((function(n){n&&(0,s.GlD)(t),e[5](null)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:i,id:j.name,type:"component",source:"",ctx:e}),i}function C(e,t,n){let{$$slots:i={},$$scope:r}=t;(0,s.KXV)("PeerStream",i,[]);let o,{media:a}=t,{isLocal:c=!1}=t,{level:l=0}=t,{full:u=!1}=t;const d=["media","isLocal","level","full"];function h(e){s.VnY[e?"unshift":"push"]((()=>{o=e,n(3,o),n(4,a)}))}return Object.keys(t).forEach((e=>{~d.indexOf(e)||"$$"===e.slice(0,2)||"slot"===e||console.warn(`<PeerStream> was created with unknown prop '${e}'`)})),_(h,"video_binding"),e.$$set=e=>{"media"in e&&n(4,a=e.media),"isLocal"in e&&n(0,c=e.isLocal),"level"in e&&n(1,l=e.level),"full"in e&&n(2,u=e.full)},e.$capture_state=()=>({media:a,isLocal:c,level:l,full:u,videoContainer:o}),e.$inject_state=e=>{"media"in e&&n(4,a=e.media),"isLocal"in e&&n(0,c=e.isLocal),"level"in e&&n(1,l=e.level),"full"in e&&n(2,u=e.full),"videoContainer"in e&&n(3,o=e.videoContainer)},t&&"$$inject"in t&&e.$inject_state(t.$$inject),e.$$.update=()=>{24&e.$$.dirty&&o&&n(3,o.srcObject=a,o)},[c,l,u,o,a,h]}_(j,"create_fragment"),_(C,"instance");var q=class extends s.Mjb{constructor(e){super(e),(0,s.S1n)(this,e,C,j,s.N8,{media:4,isLocal:0,level:1,full:2}),(0,s.YyZ)("SvelteRegisterComponent",{component:this,tagName:"PeerStream",options:e,id:j.name});const{ctx:t}=this.$$,n=e.props||{};void 0!==t[4]||"media"in n||console.warn("<PeerStream> was created without expected prop 'media'")}get media(){throw new Error("<PeerStream>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set media(e){throw new Error("<PeerStream>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get isLocal(){throw new Error("<PeerStream>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set isLocal(e){throw new Error("<PeerStream>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get level(){throw new Error("<PeerStream>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set level(e){throw new Error("<PeerStream>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}get full(){throw new Error("<PeerStream>: Props cannot be read directly from the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}set full(e){throw new Error("<PeerStream>: Props cannot be set directly on the component instance unless compiling with 'accessors: true' or '<svelte:options accessors/>'")}};_(q,"PeerStream");var E=q;function x(){return{amount:(0,c.writable)(0),size:(0,c.readable)({width:0,height:0},(()=>{})),containerSize:(0,c.readable)({width:0,height:0},(()=>{}))}}function L(e,t){const n=(0,c.readable)({width:0,height:0},(t=>{const n=u()(t,150),i=new ResizeObserver((([{contentRect:{width:e,height:t}}])=>n({width:e,height:t})));return i.observe(e),()=>i.unobserve(e)})),i=(0,c.writable)(t);return{size:(0,c.derived)([i,n],(([e,t])=>Array(e).fill(0).map(((e,t)=>t+1)).map((n=>{const i=Math.ceil(e/n),r=t.width/n*3/4,s=r*i>t.height?t.height/i:r;return{height:s,width:4*s/3}})).reduce(((e,t)=>e.width*e.height>t.width*t.height?e:t)))),amount:i,containerSize:n}}_(x,"initGridStore"),_(L,"makeGridSizeStore");var O="src/components/App.svelte";function T(e,t,n){const i=e.slice();return i[29]=t[n],i}function z(e){let t,n,i;n=new E({props:{media:e[2].media,full:!0},$$inline:!0});const r={c:_((function(){t=(0,s.bGB)("div"),(0,s.YCL)(n.$$.fragment),(0,s.LGW)(t,"class","video svelte-16155c"),(0,s.VHj)(t,"mVideoFull",e[1]),(0,s.vjr)(t,O,84,4,3044)}),"create"),m:_((function(e,r){(0,s.DsI)(e,t,r),(0,s.yef)(n,t,null),i=!0}),"mount"),p:_((function(e,i){const r={};4&i[0]&&(r.media=e[2].media),n.$set(r),2&i[0]&&(0,s.VHj)(t,"mVideoFull",e[1])}),"update"),i:_((function(e){i||((0,s.Ui)(n.$$.fragment,e),i=!0)}),"intro"),o:_((function(e){(0,s.etI)(n.$$.fragment,e),i=!1}),"outro"),d:_((function(e){e&&(0,s.GlD)(t),(0,s.vpE)(n)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:r,id:z.name,type:"if",source:"(84:2) {#if isScreenShared}",ctx:e}),r}function G(e,t){let n,i,r,o;i=new E({props:{media:t[29].media,level:t[9].get(t[29].internalID)},$$inline:!0});const a={key:e,first:null,c:_((function(){n=(0,s.bGB)("div"),(0,s.YCL)(i.$$.fragment),r=(0,s.DhX)(),(0,s.LGW)(n,"class","video svelte-16155c"),(0,s.LGW)(n,"style",t[6]),(0,s.VHj)(n,"mVideoCompact",t[1]),(0,s.vjr)(n,O,93,6,3482),this.first=n}),"create"),m:_((function(e,t){(0,s.DsI)(e,n,t),(0,s.yef)(i,n,null),(0,s.gOb)(n,r),o=!0}),"mount"),p:_((function(e,r){t=e;const a={};32&r[0]&&(a.media=t[29].media),544&r[0]&&(a.level=t[9].get(t[29].internalID)),i.$set(a),(!o||64&r[0])&&(0,s.LGW)(n,"style",t[6]),2&r[0]&&(0,s.VHj)(n,"mVideoCompact",t[1])}),"update"),i:_((function(e){o||((0,s.Ui)(i.$$.fragment,e),o=!0)}),"intro"),o:_((function(e){(0,s.etI)(i.$$.fragment,e),o=!1}),"outro"),d:_((function(e){e&&(0,s.GlD)(n),(0,s.vpE)(i)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:a,id:G.name,type:"each",source:"(93:4) {#each peersArray as peer (peer.internalID)}",ctx:t}),a}function U(e){let t,n,i,a,c,l,u;t=new o.zx({props:{label:"Leave"},$$inline:!0}),t.$on("click",e[17]);const d=[Z,N],h=[];function p(e,t){return e[1]?(260&t[0]&&(i=!((0,r.getScreenOwner)(e[2].internalID)!==e[8].internalID)),i?1:-1):0}_(p,"select_block_type_1"),~(a=p(e,[-1,-1]))&&(c=h[a]=d[a](e));const f={c:_((function(){(0,s.YCL)(t.$$.fragment),n=(0,s.DhX)(),c&&c.c(),l=(0,s.cSb)()}),"create"),m:_((function(e,i){(0,s.yef)(t,e,i),(0,s.DsI)(e,n,i),~a&&h[a].m(e,i),(0,s.DsI)(e,l,i),u=!0}),"mount"),p:_((function(e,t){let n=a;a=p(e,t),a===n?~a&&h[a].p(e,t):(c&&((0,s.dvw)(),(0,s.etI)(h[n],1,1,(()=>{h[n]=null})),(0,s.gbL)()),~a?(c=h[a],c?c.p(e,t):(c=h[a]=d[a](e),c.c()),(0,s.Ui)(c,1),c.m(l.parentNode,l)):c=null)}),"update"),i:_((function(e){u||((0,s.Ui)(t.$$.fragment,e),(0,s.Ui)(c),u=!0)}),"intro"),o:_((function(e){(0,s.etI)(t.$$.fragment,e),(0,s.etI)(c),u=!1}),"outro"),d:_((function(e){(0,s.vpE)(t,e),e&&(0,s.GlD)(n),~a&&h[a].d(e),e&&(0,s.GlD)(l)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:f,id:U.name,type:"else",source:"(104:4) {:else}",ctx:e}),f}function V(e){let t,n,i=e[8].isMediaReady&&F(e);const r={c:_((function(){i&&i.c(),t=(0,s.cSb)()}),"create"),m:_((function(e,r){i&&i.m(e,r),(0,s.DsI)(e,t,r),n=!0}),"mount"),p:_((function(e,n){e[8].isMediaReady?i?(i.p(e,n),256&n[0]&&(0,s.Ui)(i,1)):(i=F(e),i.c(),(0,s.Ui)(i,1),i.m(t.parentNode,t)):i&&((0,s.dvw)(),(0,s.etI)(i,1,1,(()=>{i=null})),(0,s.gbL)())}),"update"),i:_((function(e){n||((0,s.Ui)(i),n=!0)}),"intro"),o:_((function(e){(0,s.etI)(i),n=!1}),"outro"),d:_((function(e){i&&i.d(e),e&&(0,s.GlD)(t)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:r,id:V.name,type:"if",source:"(100:4) {#if $status === 'left'}",ctx:e}),r}function N(e){let t,n;t=new o.zx({props:{label:"Stop sharing"},$$inline:!0}),t.$on("click",e[19]);const i={c:_((function(){(0,s.YCL)(t.$$.fragment)}),"create"),m:_((function(e,i){(0,s.yef)(t,e,i),n=!0}),"mount"),p:s.ZTd,i:_((function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)}),"intro"),o:_((function(e){(0,s.etI)(t.$$.fragment,e),n=!1}),"outro"),d:_((function(e){(0,s.vpE)(t,e)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:i,id:N.name,type:"if",source:"(108:72) ",ctx:e}),i}function Z(e){let t,n;t=new o.zx({props:{label:"Share screen"},$$inline:!0}),t.$on("click",e[18]);const i={c:_((function(){(0,s.YCL)(t.$$.fragment)}),"create"),m:_((function(e,i){(0,s.yef)(t,e,i),n=!0}),"mount"),p:s.ZTd,i:_((function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)}),"intro"),o:_((function(e){(0,s.etI)(t.$$.fragment,e),n=!1}),"outro"),d:_((function(e){(0,s.vpE)(t,e)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:i,id:Z.name,type:"if",source:"(106:6) {#if !isScreenShared}",ctx:e}),i}function F(e){let t,n;t=new o.zx({props:{label:"Join"},$$inline:!0}),t.$on("click",e[16]);const i={c:_((function(){(0,s.YCL)(t.$$.fragment)}),"create"),m:_((function(e,i){(0,s.yef)(t,e,i),n=!0}),"mount"),p:s.ZTd,i:_((function(e){n||((0,s.Ui)(t.$$.fragment,e),n=!0)}),"intro"),o:_((function(e){(0,s.etI)(t.$$.fragment,e),n=!1}),"outro"),d:_((function(e){(0,s.vpE)(t,e)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:i,id:F.name,type:"if",source:"(101:6) {#if $user.isMediaReady}",ctx:e}),i}function Y(e){let t,n,i,r,a,c,l,u,d,h,p,f,m,g,v,y,$,b=[],w=new Map,S=e[1]&&z(e);a=new E({props:{media:e[8].media,level:e[9].get("user"),isLocal:!0},$$inline:!0});let I=e[5];(0,s.vzG)(I);const M=_((e=>e[29].internalID),"get_key");(0,s.HeV)(e,I,T,M);for(let t=0;t<I.length;t+=1){let n=T(e,I,t),i=M(n);w.set(i,b[t]=G(i,n))}const k=[V,U],P=[];function R(e,t){return"left"===e[10]?0:1}_(R,"select_block_type"),d=R(e),h=P[d]=k[d](e),f=new o.zx({props:{label:e[8].muted?"Unmute":"Mute"},$$inline:!0}),f.$on("click",e[20]),g=new o.zx({props:{label:e[8].camEnabled?"Disable cam":"Enable cam"},$$inline:!0}),g.$on("click",e[21]),y=new o.zx({props:{label:"Fullscreen"},$$inline:!0}),y.$on("click",e[22]);const D={c:_((function(){t=(0,s.bGB)("div"),S&&S.c(),n=(0,s.DhX)(),i=(0,s.bGB)("div"),r=(0,s.bGB)("div"),(0,s.YCL)(a.$$.fragment),c=(0,s.DhX)();for(let e=0;e<b.length;e+=1)b[e].c();l=(0,s.DhX)(),u=(0,s.bGB)("div"),h.c(),p=(0,s.DhX)(),(0,s.YCL)(f.$$.fragment),m=(0,s.DhX)(),(0,s.YCL)(g.$$.fragment),v=(0,s.DhX)(),(0,s.YCL)(y.$$.fragment),(0,s.LGW)(r,"class","video svelte-16155c"),(0,s.LGW)(r,"style",e[6]),(0,s.VHj)(r,"mVideoCompact",e[1]),(0,s.vjr)(r,O,89,4,3257),(0,s.LGW)(i,"class","videos svelte-16155c"),(0,s.LGW)(i,"style",e[7]),(0,s.VHj)(i,"mVideosCompact",e[1]),(0,s.vjr)(i,O,88,2,3174),(0,s.LGW)(u,"class","controls svelte-16155c"),(0,s.vjr)(u,O,98,2,3672),(0,s.LGW)(t,"class","root svelte-16155c"),(0,s.vjr)(t,O,82,0,2976)}),"create"),l:_((function(e){throw new Error("options.hydrate only works if the component was compiled with the `hydratable: true` option")}),"claim"),m:_((function(o,h){(0,s.DsI)(o,t,h),S&&S.m(t,null),(0,s.gOb)(t,n),(0,s.gOb)(t,i),(0,s.gOb)(i,r),(0,s.yef)(a,r,null),(0,s.gOb)(i,c);for(let e=0;e<b.length;e+=1)b[e].m(i,null);(0,s.gOb)(t,l),(0,s.gOb)(t,u),P[d].m(u,null),(0,s.gOb)(u,p),(0,s.yef)(f,u,null),(0,s.gOb)(u,m),(0,s.yef)(g,u,null),(0,s.gOb)(u,v),(0,s.yef)(y,u,null),e[27](t),$=!0}),"mount"),p:_((function(e,o){e[1]?S?(S.p(e,o),2&o[0]&&(0,s.Ui)(S,1)):(S=z(e),S.c(),(0,s.Ui)(S,1),S.m(t,n)):S&&((0,s.dvw)(),(0,s.etI)(S,1,1,(()=>{S=null})),(0,s.gbL)());const c={};256&o[0]&&(c.media=e[8].media),512&o[0]&&(c.level=e[9].get("user")),a.$set(c),(!$||64&o[0])&&(0,s.LGW)(r,"style",e[6]),2&o[0]&&(0,s.VHj)(r,"mVideoCompact",e[1]),610&o[0]&&(I=e[5],(0,s.vzG)(I),(0,s.dvw)(),(0,s.HeV)(e,I,T,M),b=(0,s.GQg)(b,o,M,1,e,I,w,i,s.cly,G,null,T),(0,s.gbL)()),(!$||128&o[0])&&(0,s.LGW)(i,"style",e[7]),2&o[0]&&(0,s.VHj)(i,"mVideosCompact",e[1]);let l=d;d=R(e),d===l?P[d].p(e,o):((0,s.dvw)(),(0,s.etI)(P[l],1,1,(()=>{P[l]=null})),(0,s.gbL)(),h=P[d],h?h.p(e,o):(h=P[d]=k[d](e),h.c()),(0,s.Ui)(h,1),h.m(u,p));const m={};256&o[0]&&(m.label=e[8].muted?"Unmute":"Mute"),f.$set(m);const v={};256&o[0]&&(v.label=e[8].camEnabled?"Disable cam":"Enable cam"),g.$set(v)}),"update"),i:_((function(e){if(!$){(0,s.Ui)(S),(0,s.Ui)(a.$$.fragment,e);for(let e=0;e<I.length;e+=1)(0,s.Ui)(b[e]);(0,s.Ui)(h),(0,s.Ui)(f.$$.fragment,e),(0,s.Ui)(g.$$.fragment,e),(0,s.Ui)(y.$$.fragment,e),$=!0}}),"intro"),o:_((function(e){(0,s.etI)(S),(0,s.etI)(a.$$.fragment,e);for(let e=0;e<b.length;e+=1)(0,s.etI)(b[e]);(0,s.etI)(h),(0,s.etI)(f.$$.fragment,e),(0,s.etI)(g.$$.fragment,e),(0,s.etI)(y.$$.fragment,e),$=!1}),"outro"),d:_((function(n){n&&(0,s.GlD)(t),S&&S.d(),(0,s.vpE)(a);for(let e=0;e<b.length;e+=1)b[e].d();P[d].d(),(0,s.vpE)(f),(0,s.vpE)(g),(0,s.vpE)(y),e[27](null)}),"destroy")};return(0,s.YyZ)("SvelteRegisterBlock",{block:D,id:Y.name,type:"component",source:"",ctx:e}),D}function W(e,t,n){let i,c,l,u,d,h,p,f=s.ZTd,m=_((()=>(f(),f=(0,s.LdU)(j,(e=>n(24,i=e))),j)),"$$subscribe_cSize"),g=s.ZTd,v=_((()=>(g(),g=(0,s.LdU)(D,(e=>n(25,c=e))),D)),"$$subscribe_size");e.$$.on_destroy.push((()=>f())),e.$$.on_destroy.push((()=>g()));let{$$slots:y={},$$scope:$}=t;(0,s.KXV)("App",y,[]);var b=this&&this.__awaiter||function(e,t,n,i){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return _(r,"adopt"),new(n||(n=Promise))((function(n,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?n(e.value):r(e.value).then(o,a)}_(o,"fulfilled"),_(a,"rejected"),_(c,"step"),c((i=i.apply(e,t||[])).next())}))};const{user:w,screen:S,peers:I,status:M,gains:k}=re;let P;(0,s.uZK)(w,"user"),(0,s.FIv)(e,w,(e=>n(8,d=e))),(0,s.uZK)(S,"screen"),(0,s.FIv)(e,S,(e=>n(2,u=e))),(0,s.uZK)(I,"peers"),(0,s.FIv)(e,I,(e=>n(26,l=e))),(0,s.uZK)(M,"status"),(0,s.FIv)(e,M,(e=>n(10,p=e))),(0,s.uZK)(k,"gains"),(0,s.FIv)(e,k,(e=>n(9,h=e)));let{amount:R,size:D,containerSize:j}=x();(0,s.uZK)(D,"size"),v(),(0,s.uZK)(j,"cSize"),m();let C=!1,q=[];function O(){return b(this,void 0,void 0,(function*(){re.join("common")}))}function T(){re.leave()}function z(){re.shareScreen()}function G(){re.stopSharingScreen()}function U(){return b(this,void 0,void 0,(function*(){yield re.toggleMute()}))}function V(){return b(this,void 0,void 0,(function*(){yield re.toggleCam()}))}function N(){null==P||P.requestFullscreen()}_(O,"join"),_(T,"leave"),_(z,"shareScreen"),_(G,"stopSharing"),(0,a.onDestroy)((()=>re.leave())),_(U,"toggleMute"),_(V,"toggleCam"),_(N,"requestFullscreen");let Z="",F="";const Y=[];function W(e){s.VnY[e?"unshift":"push"]((()=>{P=e,n(0,P)}))}return Object.keys(t).forEach((e=>{~Y.indexOf(e)||"$$"===e.slice(0,2)||"slot"===e||console.warn(`<App> was created with unknown prop '${e}'`)})),_(W,"div3_binding"),e.$capture_state=()=>({__awaiter:b,onDestroy:a.onDestroy,Button:o.zx,PeerStream:E,initGridStore:x,makeGridSizeStore:L,getScreenOwner:r.getScreenOwner,roomMgr:re,user:w,screen:S,peers:I,status:M,gains:k,container:P,amount:R,size:D,cSize:j,isScreenShared:C,peersArray:q,join:O,leave:T,shareScreen:z,stopSharing:G,toggleMute:U,toggleCam:V,requestFullscreen:N,videoStyle:Z,videosStyle:F,$cSize:i,$size:c,$peers:l,$screen:u,$user:d,$gains:h,$status:p}),e.$inject_state=e=>{"__awaiter"in e&&(b=e.__awaiter),"container"in e&&n(0,P=e.container),"amount"in e&&n(23,R=e.amount),"size"in e&&v(n(3,D=e.size)),"cSize"in e&&m(n(4,j=e.cSize)),"isScreenShared"in e&&n(1,C=e.isScreenShared),"peersArray"in e&&n(5,q=e.peersArray),"videoStyle"in e&&n(6,Z=e.videoStyle),"videosStyle"in e&&n(7,F=e.videosStyle)},t&&"$$inject"in t&&e.$inject_state(t.$$inject),e.$$.update=()=>{if(67108865&e.$$.dirty[0]&&P&&I){const e=L(P,l.size+1);n(23,R=e.amount),v(n(3,D=e.size)),m(n(4,j=e.containerSize))}75497476&e.$$.dirty[0]&&l&&R.set(l.size+1+(u.isMediaReady?1:0)),4&e.$$.dirty[0]&&u&&n(1,C=u.isMediaReady),67108864&e.$$.dirty[0]&&n(5,q=[...l.values()]),33554434&e.$$.dirty[0]&&n(6,Z=C?"":`width: ${c.width}px; height: ${c.height}px`),16777218&e.$$.dirty[0]&&n(7,F=C?"":`width: ${i.width}px`)},[P,C,u,D,j,q,Z,F,d,h,p,w,S,I,M,k,O,T,z,G,U,V,N,R,i,c,l,W]}_(T,"get_each_context"),_(z,"create_if_block_4"),_(G,"create_each_block"),_(U,"create_else_block"),_(V,"create_if_block"),_(N,"create_if_block_3"),_(Z,"create_if_block_2"),_(F,"create_if_block_1"),_(Y,"create_fragment"),_(W,"instance");var B=class extends s.Mjb{constructor(e){super(e),(0,s.S1n)(this,e,W,Y,s.N8,{},null,[-1,-1]),(0,s.YyZ)("SvelteRegisterComponent",{component:this,tagName:"App",options:e,id:Y.name})}};_(B,"App");var H=B,A=(0,h.mergeIds)(d.default,{component:{CreateChannel:"",WorkspaceComponent:""}}),X=class{constructor(e){this.ctx=new AudioContext,this.FFT_SIZE=2048,this.analyzer=new AnalyserNode(this.ctx,{fftSize:this.FFT_SIZE,smoothingTimeConstant:.01});const t=new MediaStream([e]);this.src=this.ctx.createMediaStreamSource(t),this.src.connect(this.analyzer)}close(){this.analyzer.disconnect(),this.src.disconnect(),this.ctx.close()}getValue(){const e=new Float32Array(this.FFT_SIZE);return this.analyzer.getFloatTimeDomainData(e),Math.sqrt(e.reduce(((e,t)=>e+$(t,2)),0)/e.length)}};_(X,"GainMeter");var K=_(((e,t=!0)=>({internalID:e.internalID,peer:ee(),media:new MediaStream,isMediaReady:t,muted:e.muted,camEnabled:e.camEnabled})),"makePeer"),J=_(((e,t)=>{let n=e;const i=(0,c.writable)(e,t);return{set:e=>{n=e,i.set(e)},update:e=>{n=e(n),i.set(n)},get:()=>n,run:e=>{e(n)},subscribe:i.subscribe}}),"extWritable"),Q=_((e=>(e.media.getTracks().forEach((t=>{t.stop(),e.media.removeTrack(t)})),S(w({},e),{isMediaReady:!1}))),"releaseMedia"),ee=_((()=>new RTCPeerConnection({iceServers:[{urls:["stun:stun.l.google.com:19302"]}]})),"makeWebRTCPeer"),te=class{constructor(e){this._peers=J(new Map),this._user=J(K({internalID:"",muted:!1,camEnabled:!0},!1),(()=>(this.queue.add((()=>I(this,null,(function*(){return yield this.initMedia()})))),()=>{this.queue.add((()=>I(this,null,(function*(){return this.releaseMedia()}))))}))),this._screen=J(K({internalID:"",muted:!0,camEnabled:!0},!1)),this._status=J("left"),this._gains=J(new Map),this.queue=new r.TaskQueue,this.gainMeters=new Map,this.pollPeerGain=_((e=>t=>{const n=new X(t),i=setInterval((()=>{const t=this._gains.get().get(e),i=n.getValue()>.01?1:0;i!==t&&this._gains.update((t=>(t.set(e,i),t)))}),100);this.gainMeters.set(e,{meter:n,timeoutHandler:i})}),"pollPeerGain"),this.client=e;const t=this.handle.bind(this);this.client.subscribe(r.NotificationMethod.ICECandidate,t),this.client.subscribe(r.NotificationMethod.PeerJoined,t),this.client.subscribe(r.NotificationMethod.PeerLeft,t),this.client.subscribe(r.NotificationMethod.ScreenSharingFinished,t),this.client.subscribe(r.NotificationMethod.ScreenSharingStarted,t),this.client.subscribe(r.NotificationMethod.PeerUpdated,t)}get peers(){return this._peers}get user(){return this._user}get screen(){return this._screen}get status(){return this._status}get gains(){return this._gains}initMedia(){return I(this,null,(function*(){const e=yield navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{ideal:1280},height:{ideal:920}}});this._user.update((t=>S(w({},t),{media:e,isMediaReady:!0})))}))}releaseMedia(){this._user.update(Q);const e=this._screen.get(),t=this._user.get();e.owner===t.internalID&&this._screen.update(Q)}toggleMute(){return I(this,null,(function*(){const e=this._user.get();if("left"!==this._status.get()){const{peer:t}=yield this.client.sendRequest({method:r.ReqMethod.PeerUpdate,params:[{muted:!e.muted}]});this._user.update((e=>w(w({},e),t)))}else this._user.update((e=>S(w({},e),{muted:!e.muted})));const t=this._user.get();t.media.getAudioTracks().forEach((e=>e.enabled=!t.muted))}))}toggleCam(){return I(this,null,(function*(){const e=this._user.get();if("left"!==this._status.get()){const{peer:t}=yield this.client.sendRequest({method:r.ReqMethod.PeerUpdate,params:[{camEnabled:!e.camEnabled}]});this._user.update((e=>w(w({},e),t)))}else this._user.update((e=>S(w({},e),{camEnabled:!e.camEnabled})));const t=this._user.get();t.media.getVideoTracks().forEach((e=>e.enabled=t.camEnabled))}))}init(e){return I(this,null,(function*(){if("left"!==this._status.get())if(void 0!==e){if(this._status.set("joined"),this._user.update((t=>{var n;return S(w(w({},t),null!=(n=e.me)?n:{}),{peer:ee()})})),yield this.setupPeer(this._user.get(),this.pollPeerGain("user")),this._peers.set(new Map(e.peers.map((e=>[e.internalID,K(e,!0)])))),yield Promise.all([...this._peers.get().values()].map((e=>I(this,null,(function*(){return yield this.setupPeer(e,this.pollPeerGain(e.internalID),!0)}))))),void 0!==e.screen){const t=e.screen.peer.internalID,n=e.screen.owner;this._screen.update((e=>S(w({},e),{internalID:t,peer:ee(),isMediaReady:!0,owner:n}))),yield this.setupPeer(this._screen.get(),(()=>{}),!0)}}else console.error("Failed to join room: missing result")}))}join(e){return I(this,null,(function*(){if("left"!==this._status.get())return;this._status.set("joining");const t=this._user.get();try{const n=yield this.client.sendRequest({method:r.ReqMethod.Join,params:[{room:e,peer:{camEnabled:t.camEnabled,muted:t.muted}}]});yield this.queue.add((()=>I(this,null,(function*(){return yield this.init(n)}))))}catch(e){console.error(e),this._status.set("left")}}))}leave(){return I(this,null,(function*(){this._user.run((e=>{e.peer.close()})),this._peers.run((e=>{e.forEach((e=>{e.peer.close(),Q(e)}))})),this._peers.set(new Map),[...this.gainMeters.values()].forEach((({timeoutHandler:e,meter:t})=>{clearInterval(e),t.close()})),this.gainMeters.clear(),this._gains.set(new Map);const e=this._screen.get(),t=this._user.get();e.owner===t.internalID&&(yield this.handleScreenSharingFinished()),this._status.set("left"),yield this.client.sendRequest({method:r.ReqMethod.Leave,params:[]})}))}shareScreen(){return I(this,null,(function*(){var e;if("joined"!==this._status.get())return;if(this._screen.get().isMediaReady)return;const t=yield navigator.mediaDevices.getDisplayMedia({audio:!1,video:{frameRate:{ideal:30}}});null==(e=t.getTracks()[0])||e.addEventListener("ended",(()=>{this.stopSharingScreen()})),this._screen.update((e=>S(w({},e),{media:t,isMediaReady:!0})));const{peerID:n}=yield this.client.sendRequest({method:r.ReqMethod.InitScreenSharing,params:[]});yield this.queue.add((()=>I(this,null,(function*(){return yield this.handleScreenSharingStarted(n,this._user.get().internalID)}))))}))}stopSharingScreen(){return I(this,null,(function*(){const e=this._screen.get(),t=this._user.get();e.owner===t.internalID&&(yield this.queue.add((()=>I(this,null,(function*(){return yield this.handleScreenSharingFinished()})))))}))}handle(e){return I(this,null,(function*(){"left"!==this._status.get()&&(yield this.queue.add((()=>I(this,null,(function*(){const{result:t}=e;if(void 0!==t)switch(t.notification){case r.NotificationMethod.ICECandidate:{const e=this.findPeer(t.params.peerID);if(void 0===e)return;return void(yield e.peer.addIceCandidate(t.params.candidate))}case r.NotificationMethod.PeerJoined:{const e=K(t.params.peer,!0);return this._peers.update((t=>(t.set(e.internalID,e),t))),void(yield this.setupPeer(e,this.pollPeerGain(e.internalID),!0))}case r.NotificationMethod.PeerLeft:{const e=t.params.peerID,n=this._peers.get().get(e);if(void 0===n)return;const i=this.gainMeters.get(e);return clearTimeout(null==i?void 0:i.timeoutHandler),null==i||i.meter.close(),this.gainMeters.delete(e),this._gains.update((t=>(t.delete(e),t))),this._peers.update((t=>(t.delete(e),t))),Q(n),void n.peer.close()}case r.NotificationMethod.ScreenSharingStarted:return void(yield this.handleScreenSharingStarted(t.params.peerID,t.params.owner));case r.NotificationMethod.ScreenSharingFinished:return void this.handleScreenSharingFinished();case r.NotificationMethod.PeerUpdated:{const e=this._peers.get().get(t.params.peer.internalID);if(void 0===e)return;this._peers.update((n=>(n.set(e.internalID,w(w({},e),t.params.peer)),n)))}}})))))}))}handleScreenSharingStarted(e,t){return I(this,null,(function*(){this._screen.update((n=>S(w({},n),{internalID:e,peer:ee(),isMediaReady:!0,owner:t})));const n=this._screen.get(),i=this._user.get();yield this.setupPeer(n,(()=>{}),n.owner!==i.internalID)}))}handleScreenSharingFinished(){return I(this,null,(function*(){const e=this._screen.get();Q(e),e.peer.close(),this._screen.update((e=>S(w({},e),{id:"",internalID:"",isMediaReady:!1,owner:void 0}))),"joined"===this._status.get()&&(yield this.client.sendRequest({method:r.ReqMethod.StopScreenSharing,params:[]}))}))}findPeer(e){return this._user.get().internalID===e?this._user.get():this._screen.get().internalID===e?this._screen.get():this._peers.get().get(e)}setupPeer(e,t,n=!1){return I(this,null,(function*(){n?(e.peer.addTransceiver("audio",{direction:"recvonly"}),e.peer.addTransceiver("video",{direction:"recvonly"}),e.peer.addEventListener("track",(({track:n})=>{"audio"===n.kind&&t(n),e.media.addTrack(n)}))):e.media.getTracks().forEach((n=>{"audio"===n.kind&&t(n),e.peer.addTrack(n)})),e.peer.addEventListener("icecandidate",(({candidate:t})=>{null!==t&&null!==t.sdpMid&&this.client.sendNotification({method:r.NotificationMethod.ICECandidate,params:[{candidate:t,peerID:e.internalID}]})})),yield e.peer.createOffer().then((t=>I(this,null,(function*(){var n;yield e.peer.setLocalDescription(t);const i=yield this.client.sendRequest({method:r.ReqMethod.Transmit,params:[{peerID:e.internalID,sdp:null!=(n=t.sdp)?n:""}]});yield e.peer.setRemoteDescription({type:"answer",sdp:null==i?void 0:i.sdp})}))))}))}};_(te,"RoomMgr");var ne,ie=_((()=>I(void 0,null,(function*(){return(0,i.setResource)(A.component.CreateChannel,D),(0,i.setResource)(A.component.WorkspaceComponent,H),{}}))),"default"),re=new te(new r.Client(`ws://${null!=(ne=(0,i.getMetadata)(A.metadata.ClientUrl))?ne:"localhost:18081"}/ws`))}}]);
"use strict";(self.webpackChunkprod=self.webpackChunkprod||[]).push([[527],{6408:(i,e,t)=>{t.r(e),t.d(e,{default:()=>r,fsmPlugin:()=>c});var d=t(41350),n=t.n(d),o=t(9479),s=t(14452),l=t(30248);const c=(0,t(98097).mergeIds)(l.default,{});var a=function(i,e,t,d){return new(t||(t=Promise))((function(n,o){function s(i){try{c(d.next(i))}catch(i){o(i)}}function l(i){try{c(d.throw(i))}catch(i){o(i)}}function c(i){var e;i.done?n(i.value):(e=i.value,e instanceof t?e:new t((function(i){i(e)}))).then(s,l)}c((d=d.apply(i,e||[])).next())}))};const r=()=>a(void 0,void 0,void 0,(function*(){const i=yield(0,o.getPlugin)(s.default.id),e=yield i.getClient(),t=i=>a(void 0,void 0,void 0,(function*(){return yield e.findAll(c.class.State,{fsm:i})})),d=i=>a(void 0,void 0,void 0,(function*(){return yield e.findAll(c.class.Transition,{fsm:i}).then((i=>i.filter((i=>void 0!==i))))}));return{getStates:t,getTransitions:d,addItem:(i,d,n=i._id)=>a(void 0,void 0,void 0,(function*(){var o,s;const l=yield(i=>a(void 0,void 0,void 0,(function*(){return(yield e.findAll(c.class.FSM,{_id:i.fsm}))[0]})))(i);if(void 0===l)return;const r=null!==(o=d.obj.state)&&void 0!==o?o:(yield t(l._id))[0]._id;return yield e.createDoc(null!==(s=d._class)&&void 0!==s?s:c.class.FSMItem,n,Object.assign(Object.assign({},d.obj),{fsm:i._id,state:r}))})),removeItem:(i,t)=>a(void 0,void 0,void 0,(function*(){const d=yield e.findAll(c.class.FSMItem,{item:i,fsm:t._id});yield Promise.all(d.map((i=>a(void 0,void 0,void 0,(function*(){return yield e.removeDoc(i._class,n().space.Model,i._id)})))))})),duplicateFSM:i=>a(void 0,void 0,void 0,(function*(){const o=(yield e.findAll(c.class.FSM,{_id:i}))[0];if(void 0===o)return;const s=yield d(o._id),l=yield t(o._id),r=i=>Object.entries(i).filter((([i])=>!["_id","modifiedBy","modifiedOn","createOn"].includes(i))).reduce(((i,[e,t])=>Object.assign(Object.assign({},i),{[e]:t})),{}),u=yield e.createDoc(c.class.FSM,n().space.Model,Object.assign(Object.assign({},r(o)),{isTemplate:!1})),v=yield Promise.all(l.map((i=>a(void 0,void 0,void 0,(function*(){return[i,yield e.createDoc(c.class.State,n().space.Model,Object.assign(Object.assign({},r(i)),{fsm:u._id}))]}))))).then((i=>new Map(i.map((([i,e])=>[i._id,e._id])))));return yield Promise.all(s.map((i=>a(void 0,void 0,void 0,(function*(){var t,d;return yield e.createDoc(c.class.Transition,n().space.Model,Object.assign(Object.assign({},r(i)),{fsm:u._id,from:null!==(t=v.get(i.from))&&void 0!==t?t:"",to:null!==(d=v.get(i.to))&&void 0!==d?d:""}))}))))),u}))}}))}}]);